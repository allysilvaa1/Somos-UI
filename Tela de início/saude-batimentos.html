<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Histórico de Batimentos - Prontuário Médico</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style type="text/tailwindcss">
      body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-[#F0F7FF]">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="bg-white p-6 rounded-xl shadow-sm">
            <div class="flex justify-between items-center pb-3 border-b">
                <h1 class="text-2xl font-bold text-gray-800">Histórico de Batimentos</h1>
                <a href="./home.html" class="text-blue-600 hover:underline flex items-center">
                    <span class="material-symbols-outlined mr-1">arrow_back</span>
                    Voltar
                </a>
            </div>
            <div class="my-5">
                <div class="flex justify-end items-center mb-4">
                  <div class="flex items-center space-x-2">
                    <span class="text-sm font-medium text-gray-600">Período:</span>
                    <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 py-2 px-3" id="time-filter">
                      <option value="7">Últimos 7 dias</option>
                      <option selected value="30">Últimos 30 dias</option>
                      <option value="180">Últimos 6 meses</option>
                      <option value="all">Tudo</option>
                    </select>
                  </div>
                </div>
                <div class="relative h-96"><canvas id="healthChart"></canvas></div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let myChart;
            const metric = 'Batimentos';
            const unit = 'bpm';
            const dummyData = {
                'Peso': Array.from({length:90},(_,i)=>({x:new Date(Date.now()-(90-i)*86400000), y:75+Math.sin(i/5)*2+(Math.random()-0.5)})),
                'Altura': [{x:new Date('2023-01-15'),y:1.79},{x:new Date('2024-01-10'),y:1.80}],
                'Batimentos': Array.from({length:90},(_,i)=>({x:new Date(Date.now()-(90-i)*86400000),y:72+Math.floor(Math.random()*10)-5})),
                'Calorias': Array.from({length:90},(_,i)=>({x:new Date(Date.now()-(90-i)*86400000),y:2200+Math.floor(Math.random()*400)-200})),
                'Sono': Array.from({length:90},(_,i)=>({x:new Date(Date.now()-(90-i)*86400000),y:7.5+(Math.random()-0.5)*2})),
            };
            const getFilteredData = (data, days) => {
                if (days === 'all') return data;
                const cutoff = new Date(Date.now() - days * 86400000);
                return data.filter(d => d.x >= cutoff);
            };
            const createChart = () => {
                const ctx = document.getElementById('healthChart').getContext('2d');
                const timeFilter = document.getElementById('time-filter');
                const selected = timeFilter.value;
                const chartData = {
                    datasets: [{
                        label: `${metric} (${unit})`,
                        data: getFilteredData(dummyData[metric], selected),
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        tension: 0.1,
                        pointRadius: 4,
                        pointHoverRadius: 7,
                    }]
                };
                const config = {
                    type: 'line',
                    data: chartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { type: 'time', time: { unit: 'day', tooltipFormat: 'dd/MM/yyyy' }, title: { display: true, text: 'Data' } },
                            y: { title: { display: true, text: `Valor (${unit})` } }
                        },
                        plugins: { tooltip: { callbacks: { label: (ctx) => {
                            let label = ctx.dataset.label ? ctx.dataset.label + ': ' : '';
                            if (ctx.parsed.y !== null) label += `${ctx.parsed.y.toFixed(2)} ${unit}`;
                            return label;
                        } } } }
                    }
                };
                if (myChart) myChart.destroy();
                myChart = new Chart(ctx, config);
                timeFilter.onchange = () => createChart();
            };
            createChart();
        });
    </script>
</body>
</html>
